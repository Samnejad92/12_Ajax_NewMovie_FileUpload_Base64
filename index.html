<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title>نماوا</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">

  <meta name="theme-color" content="#fafafa">
</head>

<body>

<!-- Add your site or application content here -->
<header>
  <nav>
    <img id="logo" src="img/logo.png">
    <h1>
      نماوا
    </h1>
    <a href="genres.html" class="header__genre">لیست ژانر ها</a>
    <p class="header__search">جستجو</p>
    <img id="search" src="img/search.svg"/>
  </nav>
  <h1>250 فیلم برتر IMDB</h1>
  <p>فیلم هایی که باید حتما ببینید <br/> البته نبینید هم چیزی رو از دست ندادید!!</p>
</header>

<div class="search--container" style="display: none">
  <div class="search--overlay"></div>
  <form action="index.html" method="get">
    <div class="search--input-parent">
      <input name="q" autocomplete="off" placeholder="نام فیلمی ک دنبالش میگردی ، البته به لاتین"/>
      <img src="img/search-gray.svg">
    </div>
  </form>
</div>

<main id="home">
  <h2 id="list-title">لیست کل فیلم ها</h2>
  <div class="film--list">
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <a href="/film.html?id=1"><p class="film--name">The Shawshank Redemption</p></a>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
    <div>
      <p class="film--score">9.3</p>
      <img class="film--poster" src="http://moviesapi.ir/images/tt0068646_poster.jpg"/>
      <p class="film--name">The Shawshank Redemption</p>
      <div class="film--bottom">
        <p class="film--year">1994</p>
        <p class="film--country">USA</p>
      </div>
    </div>
  </div>
  <ul class="film--pagination">
    <li><a href="/?page=1">1</a></li> 
    <li><a href="/?page=2">2</a></li> 
    <li><a href="/?page=3">3</a></li> 
    <li><a href="/?page=4">4</a></li> 
    <li><a href="/?page=5">5</a></li> 
    <li><a href="/?page=6">6</a></li> 
    <li><a href="/?page=7">7</a></li> 
  </div>
</main>

<footer>
  <p>Made With <span style="color: red">❤</span> For You</p>
</footer>


<script src="js/vendor/modernizr-3.11.2.min.js"></script>
<script src="js/plugins.js"></script>
<script src="js/vendor/axios.js"></script>
<script src="js/main.js"></script>
<script>
  function loadFilms(data){
    const container = document.querySelector(".film--list");
    container.innerHTML = data.map(item=>`<div>
      <p class="film--score">${item.imdb_rating}</p>
      <img class="film--poster" src="${item.poster}"/>
      <a href="/film.html?id=${item.id}"><p class="film--name">${item.title}</p></a>
      <div class="film--bottom">
        <p class="film--year">${item.year}</p>
        <p class="film--country">${item.country}</p>
      </div>
    </div>`).join("");
  }

  function loadPagination(metaData){
    const count = metaData.page_count;
    const container =document.querySelector(".film--pagination");
    let pages = [];
    for (let index = 1; index <= count; index++) {
      if(Math.abs(index-metaData.current_page)<6)
        pages.push(index);
    }
    container.innerHTML = pages.map(item=>`<li class="${metaData.current_page==item && "film--pagination-active"}"><a href="/?page=${item}">${item}</a></li>`).join("");
  }
  const search =new URLSearchParams(window.location.search)
  const currentPage = search.get("page");
  const q = search.get("q");
  const genre = search.get("genre");
  
  const newSearch =new URLSearchParams();
  newSearch.append("page",currentPage);
  if(genre){
    axios.get(`http://moviesapi.ir/api/v1/genres/${genre}/movies?${newSearch.toString()}`).then(res=>{
      // console.log(res.data)
      loadFilms(res.data.data);
      loadPagination(res.data.metadata);
    }).catch(err=>{
      console.error(err);
    })
  } else {
    if(q)
      newSearch.append("q",q);
    axios.get(`http://moviesapi.ir/api/v1/movies?${newSearch.toString()}`).then(res=>{
      // console.log(res.data)
      loadFilms(res.data.data);
      loadPagination(res.data.metadata);
    }).catch(err=>{
      console.error(err);
    })
    }
</script>
</body>

</html>
